# UI Overhaul Context - Shader Playground

**Status**: In Progress
**Target**: Complete redesign of ShaderEditorPage based on Figma wireframes
**Approach**: Parallel development at `/new_editor` route while keeping original functional

---

## 🎯 Working Context

### Current Development Files
- **Primary file**: `frontend/src/pages/NewShaderEditorPage.tsx`
- **Route**: `/new_editor` (accessible at `http://localhost:5173/new_editor`)
- **Original file**: `frontend/src/pages/ShaderEditorPage.tsx` (unchanged, at `/editor`)

### UI Library
- **shadcn/ui** (New York style) - Already installed and configured
- **Config file**: `frontend/components.json`
- **Existing dependencies**:
  - `@radix-ui/react-slot`
  - `lucide-react` (icons)
  - `class-variance-authority`
  - `tailwind-merge`
  - `tailwindcss-animate`

---

## 📁 File Organization Strategy

### New Components Directory
**All new UI components MUST go in**: `frontend/src/new/`

This keeps new code separate from old code, making cleanup trivial after migration.

```
frontend/src/new/
├── components/          # New UI components
│   ├── EditorLayout.tsx
│   ├── EditorToolbar.tsx
│   ├── ShaderCanvas.tsx
│   ├── CodeEditor.tsx
│   └── ...
├── hooks/              # New hooks specific to new UI
│   └── useEditorLayout.tsx
└── lib/                # New utilities (if needed)
    └── ...
```

### shadcn/ui Components
**Location**: `frontend/src/components/ui/` (standard shadcn location)

These will be generated by shadcn CLI and can be used by both old and new code.

**To add shadcn components** (user will run):
```bash
npx shadcn@latest add button
npx shadcn@latest add tabs
npx shadcn@latest add card
# etc.
```

### Import Convention
```typescript
// ✅ DO: Import from @/new/ for new components
import { EditorLayout } from '@/new/components/EditorLayout'

// ✅ DO: Import shadcn components from @/components/ui/
import { Button } from '@/components/ui/button'
import { Tabs, TabsList, TabsTrigger } from '@/components/ui/tabs'

// ✅ DO: Continue using existing utilities (no UI, no changes needed)
import { GLSLCompiler } from '@/utils/GLSLCompiler'
import { WebGLRenderer } from '@/utils/WebGLRenderer'

// ❌ DON'T: Import old components (except those marked "reuse")
// import ShaderEditor from '@/components/editor/ShaderEditor'
```

---

## 🔧 Core Functionality to Preserve

### State Management (Keep Intact)
```typescript
const [shader, setShader] = useState<ShaderData | null>(null);
const [isPlaying, setIsPlaying] = useState(true);
const [compilationErrors, setCompilationErrors] = useState<CompilationError[]>([]);
const [compilationSuccess, setCompilationSuccess] = useState<boolean | undefined>(undefined);
const [allTabs, setAllTabs] = useState<TabShaderData[]>([...]);
const [panelResizeCounter, setPanelResizeCounter] = useState(0);
const [compileTrigger, setCompileTrigger] = useState(0);
```

### Critical Callbacks (Keep Intact)
- `handleCompilationResult` - Receives compilation results, auto-plays on success
- `handlePanelResize` - Triggers canvas resize when panels move
- `loadShader` - Loads shader from API (placeholder, but keep structure)

### URL Parameter Support
- Must support `?id=<shader_id>` query param for loading shared shaders
- Uses `useSearchParams()` from react-router-dom

---

## ♻️ Components to Reuse (No Changes Needed)

These components are **utility-focused** and have no significant UI that needs redesigning:

### Keep Using From Old Codebase
- **`ShaderPlayer`** (`@/components/ShaderPlayer`) - WebGL canvas wrapper
  - Handles WebGL rendering, playback controls, uniforms
  - You may replace its UI controls, but keep using the WebGL renderer

- **Utility modules** (all in `@/utils/`):
  - `GLSLCompiler.ts` - Shader compilation logic
  - `GLSLPreprocessor.ts` - Macro expansion, conditionals
  - `WebGLRenderer.ts` - Rendering loop, uniforms management
  - `ErrorLineTracking.ts` - Line number mapping
  - `GLSLLanguage.ts` - CodeMirror GLSL support

- **Hooks**:
  - `useWebGLRenderer.ts` - React hook for WebGL lifecycle

### May Need New Versions
These components have UI that may need redesign. Create new versions in `@/new/components/`:

- ❌ `ShaderEditor` → Create `@/new/components/CodeEditor` (new design)
- ❌ `CodeMirrorEditor` → May reuse or create new wrapper in `@/new/`
- ❌ Navigation toolbar → Create `@/new/components/EditorToolbar`
- ❌ Error decorations → May need styling updates

---

## 🎨 Design Implementation Guidelines

### Color Scheme
Maintain dark theme aesthetic (Shadertoy-inspired):
- Background: `bg-gray-900`, `bg-gray-950`
- Panels: `bg-gray-800`, `bg-gray-850`
- Accents: Use Tailwind blue/purple for interactive elements

### Layout Structure
Current layout uses `react-resizable-panels` with horizontal split:
- Left panel: Shader preview canvas
- Right panel: Code editor with tabs

**If changing layout**, ensure:
- Canvas resizes correctly when panels/windows resize
- Panel resize still triggers `panelResizeCounter` increment
- Maintains responsive behavior

### Component Composition
- Use shadcn/ui primitives (Button, Tabs, Card, etc.)
- Build custom editor chrome in `@/new/components/`
- Keep WebGL rendering separate from UI components

---

## 🧹 Cleanup Strategy (Post-Migration)

### After Overhaul is Complete

1. **Test thoroughly** at `/new_editor`
2. **Swap routes** in `App.tsx`:
   ```typescript
   <Route path="/editor" element={<NewShaderEditorPage />} />
   <Route path="/old_editor" element={<ShaderEditorPage />} /> // Keep as backup
   ```
3. **Monitor for issues** in production
4. **Delete old components** (safe because everything is in `@/new/`):
   ```bash
   rm -rf frontend/src/components/editor/
   rm frontend/src/components/ShaderPlayer.tsx  # If replaced
   rm frontend/src/pages/ShaderEditorPage.tsx   # Original page
   ```
5. **Move new components** to standard locations:
   ```bash
   mv frontend/src/new/components/* frontend/src/components/
   mv frontend/src/new/hooks/* frontend/src/hooks/
   rmdir frontend/src/new/
   ```
6. **Update imports** across codebase (find/replace `@/new/` → `@/`)

---

## 📋 Testing Checklist

### Core Features to Verify
- [ ] Shader compilation works (compile button triggers compilation)
- [ ] Error messages display correctly with line numbers
- [ ] Multi-tab system (Image, Buffer A-D, Common) functions
- [ ] Play/pause/reset controls work
- [ ] Canvas resizes when panels resize
- [ ] Mouse input tracking works (`iMouse` uniform)
- [ ] FPS counter displays and updates
- [ ] URL parameter loading (`?id=xyz`) works (when backend connected)
- [ ] CodeMirror syntax highlighting and autocomplete work
- [ ] Error decorations appear in editor

### UI/UX to Verify
- [ ] Responsive layout (no overflow, proper scrolling)
- [ ] Smooth animations and transitions
- [ ] Keyboard shortcuts work (if implemented)
- [ ] Focus states for accessibility
- [ ] Loading states during compilation
- [ ] Success/error feedback is clear

---

## 🚀 shadcn/ui Component Reference

### Commonly Needed Components

**Layout**
```bash
npx shadcn@latest add card
npx shadcn@latest add separator
npx shadcn@latest add resizable  # If replacing react-resizable-panels
```

**Interactive**
```bash
npx shadcn@latest add button
npx shadcn@latest add tabs
npx shadcn@latest add dropdown-menu
npx shadcn@latest add dialog
npx shadcn@latest add tooltip
```

**Forms & Input**
```bash
npx shadcn@latest add input
npx shadcn@latest add select
npx shadcn@latest add switch
npx shadcn@latest add slider
```

**Feedback**
```bash
npx shadcn@latest add alert
npx shadcn@latest add badge
npx shadcn@latest add toast
npx shadcn@latest add progress
```

**Icons**
Already have `lucide-react` installed:
```typescript
import { Play, Pause, RotateCcw, Code, Eye } from 'lucide-react'
```

---

## 🔄 Migration Plan

### Phase 1: Setup ✅
- [x] Create `NewShaderEditorPage.tsx`
- [x] Add `/new_editor` route
- [x] Verify functionality parity

### Phase 2: UI Development (Current)
- [ ] Create `frontend/src/new/` folder structure
- [ ] Implement new layout based on Figma wireframes
- [ ] Build new components using shadcn/ui
- [ ] Style with Tailwind + shadcn theme
- [ ] Integrate existing utilities (compiler, renderer)
- [ ] Test all core features

### Phase 3: Polish
- [ ] Responsive design tweaks
- [ ] Accessibility improvements (ARIA, keyboard nav)
- [ ] Loading states and animations
- [ ] Error handling UX
- [ ] Performance optimization

### Phase 4: Cutover
- [ ] User acceptance testing
- [ ] Swap routes (`/editor` → new version)
- [ ] Monitor for regressions
- [ ] Delete old components
- [ ] Clean up file structure

---

## 📝 Notes for Claude Code

- **DO NOT edit** `ShaderEditorPage.tsx` or components in `@/components/editor/`
- **DO create** all new UI in `@/new/` folder
- **DO reuse** utility modules (`@/utils/`) - they're UI-agnostic
- **DO use** shadcn/ui components for consistent design
- **DO preserve** all state management and callbacks
- **DO NOT run** `npx` commands (user handles package management)
- **DO test** frequently by navigating to `/new_editor`

---

## 🔗 Related Files

- `CLAUDE.md` - Project overview and architecture
- `Project_Checkpoint_10-8.md` - Detailed feature status
- `README.md` - Project goals and roadmap
- `frontend/components.json` - shadcn/ui configuration
- `frontend/tailwind.config.js` - Tailwind configuration

---

**Last Updated**: October 2025
**Next Review**: After Phase 2 completion
